<!DOCTYPE html>
<html lang="tr">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>KonuÅŸma TanÄ±ma</title>
    <link
      rel="stylesheet"
      href="{{ url_for('static', filename='style.css') }}"
    />
    <link
      href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap"
      rel="stylesheet"
    />
  </head>
  <body>
    <div class="container">
      <header>
        <h1>KonuÅŸma TanÄ±ma</h1>
        <p>Ä°ngilizce konuÅŸun, sÃ¶yledikleriniz ekrana yazÄ±lsÄ±n!</p>
      </header>
      <main>
        <div class="buttons">
          <button id="start-btn">ğŸ¤ KonuÅŸmaya BaÅŸla</button>
          <button id="stop-btn" disabled>â¹ï¸ KonuÅŸmayÄ± Durdur</button>
        </div>
        <div id="result" class="hidden">
          <div class="result-box">
            <p><strong>SÃ¶ylenen:</strong> <span id="recognized-text"></span></p>
          </div>
        </div>
      </main>
    </div>

    <script>
      let isListening = false; // Dinleme durumunu takip etmek iÃ§in
      let mediaRecorder; // Mikrofon kaydÄ± iÃ§in

      document
        .getElementById("start-btn")
        .addEventListener("click", function () {
          if (!isListening) {
            console.log("Dinleme baÅŸladÄ±!");
            isListening = true;
            document.getElementById("start-btn").disabled = true;
            document.getElementById("stop-btn").disabled = false;

            fetch("/recognize", {
              method: "POST",
              headers: {
                "Content-Type": "application/json",
              },
            })
              .then((response) => {
                if (!response.ok) {
                  throw new Error("AÄŸ hatasÄ±: " + response.statusText);
                }
                return response.json();
              })
              .then((data) => {
                if (data.error) {
                  alert("Hata: " + data.error);
                } else {
                  document.getElementById("recognized-text").innerText =
                    data.text;
                  document.getElementById("result").classList.remove("hidden");
                }
              })
              .catch((error) => {
                console.error("Hata:", error);
                alert("Bir hata oluÅŸtu: " + error.message);
              })
              .finally(() => {
                isListening = false;
                document.getElementById("start-btn").disabled = false;
                document.getElementById("stop-btn").disabled = true;
              });
          }
        });

      document
        .getElementById("stop-btn")
        .addEventListener("click", function () {
          if (isListening) {
            console.log("Dinleme durduruldu!");
            isListening = false;
            document.getElementById("start-btn").disabled = false;
            document.getElementById("stop-btn").disabled = true;

            // Mikrofon kaydÄ±nÄ± durdur (eÄŸer kullanÄ±lÄ±yorsa)
            if (mediaRecorder && mediaRecorder.state === "recording") {
              mediaRecorder.stop();
            }
          }
        });
    </script>
  </body>
</html>
